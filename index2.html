<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Game with Centered Score & Joystick</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      user-select: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* Center container, allow full-width up to 600px */
    #game-container {
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      position: relative;
    }

    /* Responsive canvas */
    #canvas {
      width: 100%;
      height: auto;
      display: block;
      background: #eef;
    }

    /* Restart button centered over canvas */
    #restart {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      font-size: 18px;
      display: none;
      z-index: 10;
    }

    /* Joystick wrapper sits below the canvas */
    #joystick-wrapper {
      width: 100%;
      max-width: 600px;
      margin: 10px auto;
      text-align: center;
    }

    /* Joystick base */
    #joystick-container {
      display: inline-block;
      width: 240px;
      height: 240px;
      border-radius: 50%;
      background: rgba(0,0,0,0.25);
      touch-action: none;
      overflow: hidden;
      position: relative;
    }

    /* Joystick thumb */
    #joystick-thumb {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(0,0,0,0.5);
      left: calc(50% - 40px);
      top:  calc(50% - 40px);
      transition: left 0.1s, top 0.1s;
    }
  </style>
</head>
<body>
    <div><h1>CATCH THE JERRY</h1></div>
    <div><h3>LEVEL 2 UNLOCK at Score = 5</h3></div>
    <div style="display:flex; justify-content: center;">
        <button onclick="window.location.href='index.html'">Arrow keys</button>
        <button onclick="window.location.href='index2.html'">Joystick</button>
        <button onclick="window.location.href='index3.html'">Joystick + keys</button>
    </div>
  <div id="game-container">
    <canvas id="canvas" width="600" height="400"></canvas>
    <button id="restart">Restart</button>
  </div>

  <div id="joystick-wrapper">
    <div id="joystick-container">
      <div id="joystick-thumb"></div>
    </div>
  </div>

  <script>
  window.onload = function() {
    const canvas  = document.getElementById("canvas");
    const ctx     = canvas.getContext("2d");
    const restart = document.getElementById("restart");

    let x = 250, y = 150, vx = 0, vy = 0;
    const acceleration = 2200;
    const friction     = 0.9;
    let score = 0, gameOver = false, bombActivated = false;
    let t = Date.now();

    // Coin & bomb initial positions
    let coinx = rand(0, 600-70), coiny = rand(0, 400-70);
    let bomx  = rand(0, 600-70), bomy  = -100;

    // Assets
    const playerImg = new Image(), coinImg = new Image(), bombImg = new Image();
    playerImg.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2oP3lWLmezhBAmuHvAwuaqRv6xVX0eApt7A&s';
    coinImg.src   = 'https://www.partysuppliesindia.com/cdn/shop/products/1_36_9f92dde3-d77d-4459-a21f-63744a94c836.jpg?v=1735574298&width=1500';
    bombImg.src   = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrhGLUu7GF58R8WurYsZXGRwPSg1aER4LGrw&s';

    const bgMusic   = new Audio('background.mp3');
    const coinSound = new Audio('foodeat.mp3');
    bgMusic.loop = true; bgMusic.volume = 0.2;
    bgMusic.play().catch(() =>
      document.body.addEventListener('click', ()=> bgMusic.play(), { once:true })
    );

    // Keyboard state
    const keys = {};
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup",   e => keys[e.key.toLowerCase()] = false);

    // Joystick state & handlers
    let joyX = 0, joyY = 0;
    const base    = document.getElementById("joystick-container");
    const thumb   = document.getElementById("joystick-thumb");
    const stickR  = 240 / 2, thumbR = 80 / 2;
    const maxDisp = stickR - thumbR;
    const joyBoost = 1.2;

    function handleStart(e) { e.preventDefault(); }
    function handleMove(e) {
      const touch = e.touches[0];
      const r = base.getBoundingClientRect();
      let dx = touch.clientX - (r.left + stickR);
      let dy = touch.clientY - (r.top  + stickR);
      const dist = Math.hypot(dx, dy);

      if (dist > maxDisp) {
        dx = dx / dist * maxDisp;
        dy = dy / dist * maxDisp;
      }

      thumb.style.left = `${stickR + dx - thumbR}px`;
      thumb.style.top  = `${stickR + dy - thumbR}px`;

      joyX = dx / maxDisp;
      joyY = dy / maxDisp;
    }
    function handleEnd() {
      thumb.style.left = "calc(50% - 40px)";
      thumb.style.top  = "calc(50% - 40px)";
      joyX = joyY = 0;
    }
    base.addEventListener("touchstart",  handleStart, { passive:false });
    base.addEventListener("touchmove",   handleMove,  { passive:false });
    base.addEventListener("touchend",    handleEnd);
    base.addEventListener("touchcancel", handleEnd);

    // Restart button
    restart.onclick = () => {
      score = 0; x = 250; y = 150; vx = vy = 0;
      coinx = rand(0,600-70); coiny = rand(0,400-70);
      bomx  = rand(0,600-70); bomy  = -100;
      gameOver = false; bombActivated = false;
      restart.style.display = "none";
      t = Date.now();
      draw();
    };

    function updateVelocity(dt) {
      if (keys["d"] || keys["arrowright"]) vx += acceleration * dt;
      if (keys["a"] || keys["arrowleft"])  vx -= acceleration * dt;
      if (keys["s"] || keys["arrowdown"])  vy += acceleration * dt;
      if (keys["w"] || keys["arrowup"])    vy -= acceleration * dt;

      vx += joyX * acceleration * dt * joyBoost;
      vy += joyY * acceleration * dt * joyBoost;

      vx *= friction; vy *= friction;
      x  += vx * dt;  y  += vy * dt;

      x = clamp(x, 0, 600-100);
      y = clamp(y, 0, 400-100);
    }

    function draw() {
      const now = Date.now();
      const dt  = (now - t) / 1000;
      t = now;
      updateVelocity(dt);

      ctx.clearRect(0, 0, 600, 400);

      // Centered score
      ctx.textAlign = "center";
      ctx.font      = "25px Arial";
      ctx.fillStyle = "black";
      ctx.fillText("Score: " + score, canvas.width / 2, 30);
      ctx.textAlign = "start";

      // Bomb logic
      if (score >= 5) {
        if (!bombActivated) {
          bomx = rand(0,600-70); bomy = -100;
          bombActivated = true;
        }
        ctx.drawImage(bombImg, bomx, bomy, 70, 70);
        bomy += 3;
        if (bomy >= 400) { bomx = rand(0,600-70); bomy = -100; }
        if (overlap(bomx,bomy,70,70, x,y,100,100)) {
          gameOver = true;
          restart.style.display = "block";
        }
      }

      // Draw player & coin
      ctx.drawImage(playerImg, x, y, 100, 100);
      ctx.drawImage(coinImg, coinx, coiny, 70, 70);

      // Collect coin
      if (overlap(coinx,coiny,70,70, x,y,100,100)) {
        score++;
        coinSound.currentTime = 0;
        coinSound.play();
        setTimeout(()=>{
          coinSound.pause();
          coinSound.currentTime = 0;
        }, 3000);
        coinx = rand(0,600-70);
        coiny = rand(0,400-70);
      }

      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0,0,600,400);
        ctx.fillStyle = "white";
        ctx.font      = "90px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Game Over", 300, 200);
        return;
      }

      requestAnimationFrame(draw);
    }

    // Utilities
    function rand(min,max) { return Math.random() * (max - min) + min; }
    function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
    function overlap(x1,y1,w1,h1, x2,y2,w2,h2) {
      return x1 <= x2+w2 && x2 <= x1+w1 && y1 <= y2+h2 && y2 <= y1+h1;
    }

    playerImg.onload = () => draw();
  };
  </script>
</body>
</html>
