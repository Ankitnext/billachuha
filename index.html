<!DOCTYPE html>
<html>
<head>
    <title>360 Shooter</title>
    <style>
        canvas { background: #f0f0f0; display: block; margin: auto; }
        #restart { display: none; margin: 10px auto; display: block; padding: 10px; font-size: 16px; }
    </style>
</head>
<body>
<canvas id="canvas" width="600" height="400"></canvas>
<button id="restart">Restart</button>

<script>
window.onload = function () {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let x = 250, y = 150, vx = 0, vy = 0;
    const acceleration = 900;
    const friction = 0.9;
    const bullets = [];
    const bulletSpeed = 600;
    let aimAngle = 0;
    let lastBulletTime = 0;
    let coinx = Math.random() * (600 - 70), coiny = Math.random() * (400 - 70);
    let bomx = Math.random() * (600 - 70), bomy = -100;
    let score = 0, gameOver = false, bombActive = false;
    let t = Date.now();

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    canvas.addEventListener("mousemove", e => {
        const rect = canvas.getBoundingClientRect();
        const dx = e.clientX - rect.left - (x + 50);
        const dy = e.clientY - rect.top - (y + 50);
        aimAngle = Math.atan2(dy, dx);
    });

    canvas.addEventListener("touchmove", e => {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        const dx = touch.clientX - rect.left - (x + 50);
        const dy = touch.clientY - rect.top - (y + 50);
        aimAngle = Math.atan2(dy, dx);
    });

    const playerImg = new Image();
    const coinImg = new Image();
    const bombImg = new Image();
    playerImg.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2oP3lWLmezhBAmuHvAwuaqRv6xVX0eApt7A&s';
    coinImg.src = 'https://www.partysuppliesindia.com/cdn/shop/products/1_36_9f92dde3-d77d-4459-a21f-63744a94c836.jpg?v=1735574298&width=1500';
    bombImg.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSrhGLUu7GF58R8WurYsZXGRwPSg1aER4LGrw&s';

    const restartButton = document.getElementById("restart");
    restartButton.onclick = () => {
        score = 0;
        x = 250; y = 150;
        vx = vy = 0;
        bullets.length = 0;
        coinx = Math.random() * (600 - 70);
        coiny = Math.random() * (400 - 70);
        bomx = Math.random() * (600 - 70);
        bomy = -100;
        gameOver = false;
        bombActive = false;
        restartButton.style.display = "none";
        draw();
    };

    function update(dt) {
        // Movement
        if (keys["w"] || keys["arrowup"]) vy -= acceleration * dt;
        if (keys["s"] || keys["arrowdown"]) vy += acceleration * dt;
        if (keys["a"] || keys["arrowleft"]) vx -= acceleration * dt;
        if (keys["d"] || keys["arrowright"]) vx += acceleration * dt;

        vx *= friction;
        vy *= friction;
        x += vx * dt;
        y += vy * dt;

        x = Math.max(0, Math.min(600 - 100, x));
        y = Math.max(0, Math.min(400 - 100, y));

        // Fire bullets
        const now = Date.now();
        if (now - lastBulletTime > 150) {
            const bx = x + 50;
            const by = y + 50;
            const bvx = Math.cos(aimAngle) * bulletSpeed;
            const bvy = Math.sin(aimAngle) * bulletSpeed;
            bullets.push({ x: bx, y: by, vx: bvx, vy: bvy });
            lastBulletTime = now;
        }

        // Update bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
            bullets[i].x += bullets[i].vx * dt;
            bullets[i].y += bullets[i].vy * dt;
            // Remove offscreen bullets
            if (
                bullets[i].x < 0 || bullets[i].x > 600 ||
                bullets[i].y < 0 || bullets[i].y > 400
            ) bullets.splice(i, 1);
        }

        // Check bullet-coin collision
        bullets.forEach((b, i) => {
            if (
                b.x >= coinx && b.x <= coinx + 70 &&
                b.y >= coiny && b.y <= coiny + 70
            ) {
                score++;
                bullets.splice(i, 1);
                coinx = Math.random() * (600 - 70);
                coiny = Math.random() * (400 - 70);
            }
        });

        // Bomb logic
        if (score >= 5) {
            if (!bombActive) {
                bomx = Math.random() * (600 - 70);
                bomy = -100;
                bombActive = true;
            }
            bomy += 150 * dt;
            if (bomy > 400) {
                bomy = -100;
                bomx = Math.random() * (600 - 70);
            }

            if (
                bomx <= x + 100 && x <= bomx + 70 &&
                bomy <= y + 100 && y <= bomy + 70
            ) {
                gameOver = true;
                restartButton.style.display = "block";
            }
        }
    }

    function draw() {
        const dt = (Date.now() - t) / 1000;
        t = Date.now();
        update(dt);

        ctx.clearRect(0, 0, 600, 400);
        ctx.font = "24px Arial";
        ctx.fillStyle = "black";
        ctx.fillText("Score: " + score, 20, 30);

        // Draw coin & bomb
        ctx.drawImage(coinImg, coinx, coiny, 70, 70);
        if (bombActive) {
            ctx.drawImage(bombImg, bomx, bomy, 70, 70);
        }

        // Player
        ctx.save();
        ctx.translate(x + 50, y + 50);
        ctx.rotate(aimAngle);
        ctx.drawImage(playerImg, -50, -50, 100, 100);
        ctx.restore();

        // Bullets
        ctx.fillStyle = "red";
        bullets.forEach(b => ctx.fillRect(b.x - 5, b.y - 5, 10, 10));

        if (gameOver) {
            ctx.fillStyle = "rgba(0,0,0,0.6)";
            ctx.fillRect(0, 0, 600, 400);
            ctx.fillStyle = "white";
            ctx.font = "60px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Game Over", 300, 200);
            return;
        }

        requestAnimationFrame(draw);
    }

    playerImg.onload = draw;
};
</script>
</body>
</html>
